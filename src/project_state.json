{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "Project focused on restoring a functional demo build; a regression/error persists in the current deployment compared to versions 17/18.",
  "architectural_notes": [],
  "known_issues": [
    "Current deployment/build still shows the same error; suspected infinite update loop causing repeated state updates (regression vs v17/v18).",
    "Build/rebuild process encountered an unexpected issue in the AI/build pipeline; requires rerun."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-fix-the-immediate-runtime-crash-on-the-main-route-so-the-app-no-longer-shows-the-global-something-went-wrong-screen-minified-react-error-185-and-instead-reliably-redirects-to-the-correct-page-login-when-not-authenticated-or-the-role-dashboard-when-authenticated-or-in-demo-mode",
      "title": "Fix the immediate runtime crash on the main route (\"/\") so the app no longer shows the global \"Something went wrong!\" screen (Minified React error #185) and instead reliably redirects to the correct page (\"/login\" when not authenticated, or the role dashboard when authenticated or in Demo Mode).",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-the-invalid-react-hook-usage-that-can-trigger-minified-react-error-185-by-refactoring-getcalleruserprofilequery-in-frontend-src-hooks-usequeries-ts-so-it-does-not-call-useactor-or-any-hook-inside-a-non-hook-function-queryfn-ensure-all-callers-use-the-safe-usegetcalleruserprofile-hook-or-an-equivalent-non-hook-query-implementation-that-receives-required-dependencies-without-calling-hooks",
      "title": "Remove the invalid React hook usage that can trigger Minified React error #185 by refactoring `getCallerUserProfileQuery()` in `frontend/src/hooks/useQueries.ts` so it does not call `useActor()` (or any hook) inside a non-hook function/queryFn; ensure all callers use the safe `useGetCallerUserProfile()` hook (or an equivalent non-hook query implementation that receives required dependencies without calling hooks).",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-prevent-redirect-update-loops-caused-by-repeated-navigation-side-effects-by-adding-a-single-run-navigation-guard-to-frontend-src-components-layout-applayout-tsx-similar-to-indexgatepage-s-hasnavigated-pattern-and-ensure-redirects-use-replace-true-and-only-trigger-when-the-current-route-is-not-already-the-destination",
      "title": "Prevent redirect/update loops caused by repeated navigation side-effects by adding a single-run navigation guard to `frontend/src/components/layout/AppLayout.tsx` (similar to `IndexGatePage`'s `hasNavigated` pattern) and ensure redirects use `replace: true` and only trigger when the current route is not already the destination.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-demo-mode-is-fully-functional-without-backend-actor-availability-by-verifying-that-all-react-query-hooks-used-on-dashboards-and-common-layout-components-including-notifications-are-disabled-or-return-demo-safe-values-when-isdemoactive-is-true-so-the-demo-login-flow-works-end-to-end-with-no-runtime-errors",
      "title": "Ensure Demo Mode is fully functional without backend/actor availability by verifying that all React Query hooks used on dashboards and common layout components (including notifications) are disabled or return demo-safe values when `isDemoActive()` is true, so the demo login flow works end-to-end with no runtime errors.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-improve-the-global-error-fallback-so-that-when-an-unexpected-error-still-occurs-in-production-the-ui-shows-an-actionable-error-message-and-any-available-stack-component-stack-details-instead-of-only-a-minified-error-code-while-keeping-user-facing-text-in-english",
      "title": "Improve the global error fallback so that when an unexpected error still occurs in production, the UI shows an actionable error message and any available stack/component-stack details (instead of only a minified error code), while keeping user-facing text in English.",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Provide a functional demo mode build of the app with no runtime errors/regressions (restore working behavior seen in v17/v18).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Keep React Query provider usage consistent by ensuring the app uses a single `QueryClient` instance and that router context wiring remains stable (no double `QueryClientProvider` nesting, no mismatched query client instances between router context and provider).",
      "reqIds": [
        "REQ-5"
      ],
      "status": "pending"
    }
  ],
  "projectName": "Restore functional demo build and fix production crash (Minified React error #185)",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}